#!/bin/bash

# Git subcommand to export diff
#
# `git export-diff <base> <target>`
# ...or
# `git export-diff <target>` base=HEAD

BASE=$1
TARGET=$2
WORK_DIR=$(mktemp -d)

if [ -z "$TARGET" ]; then
    TARGET=$BASE;
    BASE="HEAD";
fi

ROOT_DIR=$(git rev-parse --show-toplevel)

cd $ROOT_DIR
git archive --prefix=root/ $BASE $(git diff --diff-filter=AMCR --name-only $TARGET $BASE) -o ${WORK_DIR}/archive.zip
unzip ${WORK_DIR}/archive.zip -d ${WORK_DIR}
open $WORK_DIR/root
